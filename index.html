<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Èí≥Â∑•ËØÅÁêÜËÆ∫ÂéÜÂπ¥ÁúüÈ¢òÔºàÊú∫Ê¢∞Âü∫Á°ÄÈÉ®ÂàÜÔºâ</title>
  <style>
    :root {
      --correct-color: #2e7d32;
      --wrong-color: #c62828;
      --primary-color: #4CAF50;
      --timer-color: #ff4757;
      --progress-color: #2196F3;
    }

    * {
      box-sizing: border-box;
    }

    body {
      font-family: Arial, sans-serif;
      line-height: 1;
      margin: 0;
      padding: 0;
      background-color: #f5f5f5;
    }

    .container {
      max-width: 800px;
      margin: 10px auto;
      padding: 10px;
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    /* ============= ÈªòËÆ§Â≠ó‰ΩìÂ§ßÂ∞èÔºàÂÖ∂‰ªñÈ°µÈù¢‰øùÊåÅ‰∏çÂèòÔºâ ============= */
    .question p, .options label, 
    #finalResult h2, .score,
    #finalResult h3, .wrong-question p,
    .wrong-question .options div {
      font-size: 60px !important;
    }

    .options label {
      display: flex;
      align-items: center;
      margin: 1px 0;
      cursor: pointer;
      padding: 4px;
      border-radius: 5px;
      transition: background 0.2s;
    }

    .options label:hover {
      background-color: #f0f0f0;
    }

    .options input[type="radio"] {
      width: 50px;
      height: 50px;
      margin-right: 20px;
      accent-color: var(--primary-color);
      cursor: pointer;
    }

    .feedback {
      font-size: 50px;
      padding: 10px;
      margin: 10px 0;
      border-radius: 10px;
      display: none;
    }

    /* ============= ‰ªÖÁº©Â∞èÁ≠îÈ¢òÈ°µÔºà#quizScreenÔºâÁöÑÂ≠ó‰Ωì ============= */
    #quizScreen .question p,
    #quizScreen .options label,
    #quizScreen .feedback,
    #quizScreen #finalResult h2,
    #quizScreen .score,
    #quizScreen #finalResult h3,
    #quizScreen .wrong-question p,
    #quizScreen .wrong-question .options div {
      font-size: 30px !important; /* Áº©Â∞è‰∏ÄÂçä */
    }

    #quizScreen .options input[type="radio"] {
      width: 25px !important; /* Áº©Â∞è‰∏ÄÂçä */
      height: 25px !important; /* Áº©Â∞è‰∏ÄÂçä */
      margin-right: 10px !important; /* Áº©Â∞è‰∏ÄÂçä */
    }

    /* ÁßªÂä®Á´ØÈÄÇÈÖçÔºà‰ªÖÁ≠îÈ¢òÈ°µÁº©Â∞èÔºâ */
    @media (max-width: 768px) {
      #quizScreen .question p,
      #quizScreen .options label,
      #quizScreen .feedback,
      #quizScreen #finalResult h2,
      #quizScreen .score,
      #quizScreen #finalResult h3,
      #quizScreen .wrong-question p,
      #quizScreen .wrong-question .options div {
        font-size: 20px !important; /* Áº©Â∞è‰∏ÄÂçä */
      }

      #quizScreen .options input[type="radio"] {
        width: 20px !important;
        height: 20px !important;
        margin-right: 7.5px !important;
      }
    }

    /* ============= ÂÖ∂‰ªñÊ†∑Âºè‰øùÊåÅ‰∏çÂèò ============= */
    .correct-feedback { 
      background: color-mix(in srgb, var(--correct-color) 10%, white);
      border-left: 5px solid var(--correct-color);
    }

    .wrong-feedback { 
      background: color-mix(in srgb, var(--wrong-color) 10%, white);
      border-left: 5px solid var(--wrong-color);
    }

    .action-btn {
      padding: 10px 20px;
      margin: 10px 0;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
      transition: background 0.3s;
      background: var(--primary-color);
      color: white;
      font-weight: bold;
    }

    .action-btn:hover { 
      background: color-mix(in srgb, var(--primary-color), black 15%);
      transform: translateY(-2px);
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    }

    .back-btn { background: #2196F3; }
    .analysis-btn { background: #9C27B0; }
    .wrong-btn { background: #FF5722; }

    .timer-container {
      position: fixed;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      flex-direction: column;
      align-items: center;
      z-index: 1000;
      width: 90%;
      max-width: 500px;
    }

    .timer {
      font: bold 18px/1.1 sans-serif;
      color: var(--timer-color);
      background: rgba(255, 255, 255, 0.9);
      padding: 0px 0px;
      border-radius: 2px;
      box-shadow: 0 2px 3px rgba(0,0,0,0.1);
      margin-bottom: 0px;
      text-align: center;
      width: 100%;
    }

    .progress-container {
      width: 100%;
      background: #e0e0e0;
      border-radius: 5px;
      overflow: hidden;
    }

    .progress-bar {
      height: 10px;
      background: var(--progress-color);
      width: 0%;
      transition: width 0.3s;
    }

    .button-group { 
      display: flex;
      gap: 20px;
      margin-top:15px;
      flex-wrap: wrap;
      justify-content: center;
    }

    .result-container { 
      max-height: 80vh; 
      overflow-y: auto; 
      padding: 15px; 
      border: 1px solid #ddd; 
      border-radius: 5px; 
      margin-top: 20px; 
    }

    .input-group { margin: 8px 0; }
    .input-group h3 { margin: 10px 0; color: #333; font-size: 18px; }

    .input-field, .name-select, .category-select {
      width: 100%;
      max-width: 400px;
      padding: 8px;
      margin: 5px 0;
      border: 2px solid #ddd;
      border-radius: 4px;
      font-size: 16px;
      transition: border-color 0.3s;
    }

    .input-field:focus, .name-select:focus, .category-select:focus {
      border-color: var(--primary-color);
      outline: none;
    }

    .wrong-question { 
      color: black; 
      margin-bottom: 7px;
      padding: 8px;
      background: #fff3e0;
      border-radius: 8px;
    }

    .correct-answer { color: var(--correct-color); font-weight: bold; }
    .wrong-answer { text-decoration: line-through; color: var(--wrong-color); }
    .credit { font-size: 20px; color: red; margin-bottom: 25px; text-align: center; }

    .password-box, .result-screen, .analysis-screen { 
      text-align: center; 
      margin: 40px 0; 
    }

    .rank-link {
      color: #2196F3;
      text-decoration: none;
      margin-top: 10px;
      display: block;
      font-size: 14px;
      cursor: pointer;
    }

    .rank-link:hover {
      text-decoration: underline;
    }

    .rank-box, .analysis-box {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 0 20px rgba(0,0,0,0.2);
      z-index: 9999;
      max-width: 500px;
      width: 90%;
      max-height: 80vh;
      overflow-y: auto;
      display: none;
    }

    .rank-header, .analysis-header {
      font-size: 24px;
      color: var(--primary-color);
      margin-bottom: 20px;
      text-align: center;
    }

    .rank-item {
      display: flex;
      justify-content: space-between;
      padding: 5px;
      border-bottom: 1px solid #eee;
    }

    .rank-number { width: 40px; font-weight: bold; }
    .rank-name { flex: 2; }
    .rank-score { flex: 1; text-align: right; color: var(--timer-color); }

    .close-btn {
      position: absolute;
      right: 15px;
      top: 15px;
      cursor: pointer;
      font-size: 24px;
      color: #999;
    }

    .category-tag {
      display: inline-block;
      padding: 3px 8px;
      background: #e3f2fd;
      color: #1976d2;
      border-radius: 4px;
      font-size: 14px;
      margin-right: 5px;
      margin-bottom: 5px;
    }

    .knowledge-item {
      margin-bottom: 8px;
      padding: 10px;
      background: #f5f5f5;
      border-radius: 5px;
    }

    .knowledge-name {
      font-weight: bold;
      margin-bottom: 5px;
    }

    .knowledge-progress {
      height: 10px;
      background: #e0e0e0;
      border-radius: 5px;
      overflow: hidden;
    }

    .knowledge-progress-bar {
      height: 100%;
      background: var(--primary-color);
    }

    .mode-selector {
      margin: 20px 0;
      text-align: center;
    }

    .mode-btn {
      padding: 10px 20px;
      margin: 0 10px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
      background: #e0e0e0;
      transition: all 0.3s;
    }

    .mode-btn.active {
      background: var(--primary-color);
      color: white;
    }

    /* Âä†ËΩΩÂä®Áîª */
    .loader {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(255,255,255,0.8);
      z-index: 9999;
      justify-content: center;
      align-items: center;
      flex-direction: column;
    }

    .loader-spinner {
      border: 5px solid #f3f3f3;
      border-top: 5px solid var(--primary-color);
      border-radius: 50%;
      width: 50px;
      height: 50px;
      animation: spin 1s linear infinite;
      margin-bottom: 15px;
    }

    .loader-text {
      font-size: 18px;
      color: #333;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <div id="loader" class="loader">
    <div class="loader-spinner"></div>
    <div class="loader-text">Âä†ËΩΩ‰∏≠ÔºåËØ∑Á®çÂÄô...</div>
  </div>

  <div id="rankBox" class="rank-box">
    <div class="close-btn" onclick="closeRank()">√ó</div>
    <div class="rank-header">üèÜ ÂÆûÊó∂ÊéíË°åÊ¶ú</div>
    <div id="rankList"></div>
  </div>

  <div id="analysisBox" class="analysis-box">
    <div class="close-btn" onclick="closeAnalysis()">√ó</div>
    <div class="analysis-header">üìä Áü•ËØÜÁÇπÂàÜÊûê</div>
    <div id="knowledgeAnalysis"></div>
  </div>

  <div class="container">
    <div id="passwordScreen" class="password-box">
      <div class="credit">Áî±È´òÂ∑û‰∏ÄËÅå MrÈªé Âà∂‰Ωú</div>
      
      <div class="mode-selector">
        <button id="practiceMode" class="mode-btn active" onclick="setMode('practice')">ÁªÉ‰π†Ê®°Âºè</button>
        <button id="examMode" class="mode-btn" onclick="setMode('exam')">ËÄÉËØïÊ®°Âºè</button>
      </div>
      
      <div class="input-group">
        <h3>ËØ∑ÈÄâÊã©ÊÇ®ÁöÑÂßìÂêçÔºö</h3>
        <select id="nameSelect" class="name-select">
          <option value="" disabled selected>ËØ∑ÈÄâÊã©ÂßìÂêç</option>
        </select>
      </div>
      
      <div class="input-group" id="categoryGroup">
        <h3>ÈÄâÊã©È¢òÁõÆÂàÜÁ±ªÔºàÂèØÈÄâÔºâÔºö</h3>
        <select id="categorySelect" class="category-select" multiple>
          <option value="all" selected>ÂÖ®ÈÉ®È¢òÁõÆ</option>
          <option value="Ëû∫Á∫π">Ëû∫Á∫π</option>
          <option value="ÈΩøËΩÆ">ÈΩøËΩÆ</option>
          <option value="ËΩ¥Êâø">ËΩ¥Êâø</option>
          <option value="Âà∂Âõæ">Êú∫Ê¢∞Âà∂Âõæ</option>
          <option value="ÊùêÊñô">ÊùêÊñô</option>
          <option value="‰º†Âä®">‰º†Âä®Êú∫ÊûÑ</option>
        </select>
      </div>
      
      <button class="action-btn" onclick="checkPassword()">ÂºÄÂßãÂÅöÈ¢ò</button>
      <a href="javascript:void(0)" class="rank-link" onclick="showRank()">Êü•ÁúãÂÆûÊó∂ÊéíË°åÊ¶ú ‚Üí</a>
    </div>
    
    <div id="quizScreen" style="display: none;">
      <div class="timer-container">
        <div id="timer" class="timer">05:00</div>
        <div class="progress-container">
          <div id="progressBar" class="progress-bar"></div>
        </div>
      </div>
      
      <div id="currentQuestion"></div>
      <div class="feedback" id="feedback"></div>
      
      <div class="button-group">
        <button class="action-btn" id="confirmBtn" onclick="checkAnswer()" style="display: none;">Á°ÆÂÆöÁ≠îÊ°à</button>
        <button class="action-btn" id="nextBtn" onclick="showNextQuestion()" style="display: none;">‰∏ã‰∏ÄÈ¢ò</button>
      </div>
      <div class="feedback" id="feedback"></div>
    </div>

    <div id="resultScreen" class="result-screen" style="display: none;">
      <div id="finalResult">
        <h2 style="color:#2196F3"></h2>
        <div class="score"></div>
        <h3></h3>
      </div>
      
      <div class="button-group">
        <button class="action-btn back-btn" onclick="location.reload()">ËøîÂõûÈ¶ñÈ°µ</button>
        <button class="action-btn analysis-btn" onclick="showAnalysis()">Êü•ÁúãÁü•ËØÜÁÇπÂàÜÊûê</button>
        <button class="action-btn wrong-btn" onclick="reviewWrongQuestions()">Â§ç‰π†ÈîôÈ¢ò</button>
      </div>
      
      <div class="result-container" id="wrongQuestionsContainer" style="display: none;">
        <h3>ÈîôÈ¢òÂõûÈ°æ</h3>
        <div id="wrongQuestionsList"></div>
      </div>
    </div>
  </div>

  <!-- ÂºïÂÖ•È¢òÂ∫ìÊñá‰ª∂ -->
  <script src="questions.js"></script>
  
  <script>
    // ÈÖçÁΩÆÈ°π
    const CONFIG = {
      storageKey: 'quiz_rank',
      wrongQuestionsKey: 'wrong_questions',
      totalQuestions: 20,
      totalTime: 300, // ÊÄªËÄÉËØïÊó∂Èó¥Ôºà5ÂàÜÈíü=300ÁßíÔºâ
      scorePerQuestion: 5,
      categories: {
        "Ëû∫Á∫π": ["Ëû∫Á∫πÁ±ªÂûã", "Ëû∫Á∫πÂèÇÊï∞", "Ëû∫Á∫πÂ∫îÁî®"],
        "ÈΩøËΩÆ": ["ÈΩøËΩÆÁ±ªÂûã", "ÈΩøËΩÆÂèÇÊï∞", "ÈΩøËΩÆ‰º†Âä®"],
        "ËΩ¥Êâø": ["ËΩ¥ÊâøÁ±ªÂûã", "ËΩ¥Êâø‰ª£Âè∑", "ËΩ¥ÊâøÂ∫îÁî®"],
        "Âà∂Âõæ": ["ËßÜÂõæË°®Ëææ", "Â∞∫ÂØ∏Ê†áÊ≥®", "Ê†áÂáÜ‰ª∂ÁîªÊ≥ï"],
        "ÊùêÊñô": ["ÈáëÂ±ûÊùêÊñô", "ÈùûÈáëÂ±ûÊùêÊñô", "ÊùêÊñôÊÄßËÉΩ"],
        "‰º†Âä®": ["Â∏¶‰º†Âä®", "Èìæ‰º†Âä®", "ÈΩøËΩÆ‰º†Âä®"]
      }
    };

    // Â≠¶ÁîüÂêçÂçï
    const studentList = [
      "Á¨¨‰∏ÄÁªÑ","Á¨¨‰∫åÁªÑ","Á¨¨‰∏âÁªÑ","Á¨¨ÂõõÁªÑ","ÈÇ±Êó•Âº∫","ÈªÑÁÅ´Êòé","Êù®ÂêçÈ©∞","Êú±Á´ã‰πæ","ÈÇ±ËÄÄÈì≠","ËëõÈáëÈπè","Ê¢ÅÁöìËΩ©",
      "ÈÉ≠ÊÅ©Áëû","Á®ãÂâëË±™","ÁΩóËøúÊòä","Ê±üÊüèÂÜ†","Âç¢ÂÆùÂ¢û","ÈÇìÈïáÊùÉ","ÈªÑÂ∫ÜÈ£û",
      "Ë∞¢Ê≥ΩÈ´ò","ÂÜØÈ∫üÊñå","Âç¢Â≠êË±™","Âº†Ë∂ÖÂüé","ÈªÑÊûê‰øä","ÈªÑÊ∞∏Èúñ","ÊùéÈºé",
      "ÈÇìÈ∏øÈïá","ÈªÑÂüπËΩ©","ÂΩ≠ÂÆ∂‰πê","ÈªÑÊñ∞Èìß","Ë∞¢ÂõΩÊ∞∏","Êõæ‰øäÁÉΩ","Êù®Ê∞∏Âª∫",
      "ÈôàÁªßË¥§","ÂàòÈáëÁÅø","Ë¢Å‰πêÊ∏Ö","Êú±ÂÜ†Â∏Ü","Âº†ÂπøÈöÜ","Ê¢ÅÂõΩ‰∫Æ","Ê¢ÅÁáïËæ∞",
      "ÈôàÊ±üÂçó","ÊûóÊµ©ÂÆá","Ëî°‰ºüÊù∞","ÊûóÊùæÊµ∑","Âêï‰ªÅÊâç","Èü¶ÊÇ¶","Áü≥Ê±üÊ∂õ",
      "ÂÆÅÈ¢¢ÁÑ∂","Âàò‰ªòÁÖúÊØÖ","Ê¢ÅÂøóÈë´","ËµñÂÖÜÈúÜ","Âº†Ê¢ìÈí•","ÂÜØÂ≠êÂº∫","ÈôàÂÆ∂Â∫Ü",
      "ÈôàÈî°Âü∫","ËãèÂ≠êËÅ™"
    ];

    // Â∫îÁî®Áä∂ÊÄÅ
    let currentQuestionIndex = 0;
    let selectedQuestions = [];
    let userAnswers = {};
    let userName = '';
    let countdownTimer;
    let remainingTime = CONFIG.totalTime;
    let currentMode = 'practice'; // 'practice' Êàñ 'exam'
    let selectedCategories = ['all'];
    let wrongQuestions = [];

    // ÂàùÂßãÂåñÂ∫îÁî®
    function initApp() {
      showLoader();
      
      // ÂàùÂßãÂåñÂ≠¶ÁîüÈÄâÊã©‰∏ãÊãâÊ°Ü
      const nameSelect = document.getElementById('nameSelect');
      nameSelect.innerHTML = '<option value="" disabled selected>ËØ∑ÈÄâÊã©ÂßìÂêç</option>';
      studentList.forEach(student => {
        const option = document.createElement('option');
        option.value = student;
        option.textContent = student;
        nameSelect.appendChild(option);
      });
      nameSelect.disabled = false;

      // ÂàùÂßãÂåñÂàÜÁ±ªÈÄâÊã©
      const categorySelect = document.getElementById('categorySelect');
      categorySelect.addEventListener('change', function() {
        selectedCategories = Array.from(this.selectedOptions).map(opt => opt.value);
        if (selectedCategories.includes('all')) {
          selectedCategories = ['all'];
          this.querySelector('option[value="all"]').selected = true;
        }
      });

      // ÂàùÂßãÂåñÊú¨Âú∞Â≠òÂÇ®
      localStorage.getItem(CONFIG.storageKey) || localStorage.setItem(CONFIG.storageKey, JSON.stringify({}));
      localStorage.getItem(CONFIG.wrongQuestionsKey) || localStorage.setItem(CONFIG.wrongQuestionsKey, JSON.stringify({}));
      
      hideLoader();
    }

    // ÊòæÁ§∫Âä†ËΩΩÂä®Áîª
    function showLoader() {
      document.getElementById('loader').style.display = 'flex';
    }

    // ÈöêËóèÂä†ËΩΩÂä®Áîª
    function hideLoader() {
      document.getElementById('loader').style.display = 'none';
    }

    // ËÆæÁΩÆËÄÉËØïÊ®°Âºè
    function setMode(mode) {
      currentMode = mode;
      document.getElementById('practiceMode').classList.toggle('active', mode === 'practice');
      document.getElementById('examMode').classList.toggle('active', mode === 'exam');
      
      if (mode === 'practice') {
        document.getElementById('categoryGroup').style.display = 'block';
      } else {
        document.getElementById('categoryGroup').style.display = 'none';
      }
    }

    // Ëé∑ÂèñÊéíË°åÊ¶úÊï∞ÊçÆ
    function getRankData() {
      return JSON.parse(localStorage.getItem(CONFIG.storageKey)) || {};
    }

    // Ëé∑ÂèñÈîôÈ¢òÊú¨Êï∞ÊçÆ
    function getWrongQuestionsData() {
      return JSON.parse(localStorage.getItem(CONFIG.wrongQuestionsKey)) || {};
    }

    // Êõ¥Êñ∞ÊúÄÈ´òÂàÜËÆ∞ÂΩï
    function updateHighScore(name, newScore, usedTime) {
      const rankData = getRankData();
      if (!rankData[name] || newScore > rankData[name].score ||
        (newScore === rankData[name].score && usedTime < rankData[name].time)) {
        rankData[name] = { score: newScore, time: usedTime };
        localStorage.setItem(CONFIG.storageKey, JSON.stringify(rankData));
      }
    }

    // Êõ¥Êñ∞ÈîôÈ¢òÊú¨
    function updateWrongQuestions(name, wrongs) {
      const wrongData = getWrongQuestionsData();
      wrongData[name] = wrongs;
      localStorage.setItem(CONFIG.wrongQuestionsKey, JSON.stringify(wrongData));
    }

    // ÁîüÊàêÊéíË°åÊ¶ú
    function generateRankList() {
      const rankData = getRankData();
      const sortedList = Object.entries(rankData).sort((a, b) => {
        if (b[1].score !== a[1].score) return b[1].score - a[1].score;
        return a[1].time - b[1].time; // ÂàÜÊï∞Áõ∏ÂêåÊó∂Áî®Êó∂Áü≠ÁöÑÊéíÂâç
      }).slice(0, 300);

      let html = sortedList.length ? '' : '<div style="text-align:center; color:#666;">ÊöÇÊó†ÊàêÁª©ËÆ∞ÂΩï</div>';
      sortedList.forEach(([name, data], index) => {
        html += `<div class="rank-item">
          <div class="rank-number">${index + 1}.</div>
          <div class="rank-name">${name}</div>
          <div class="rank-score">${data.score}ÂàÜ (${formatTime(data.time)})</div>
        </div>`;
      });
      document.getElementById('rankList').innerHTML = html;
    }

    // Ê†ºÂºèÂåñÊó∂Èó¥ÊòæÁ§∫
    function formatTime(seconds) {
      const minutes = Math.floor(seconds / 60);
      const secs = seconds % 60;
      return `${String(minutes).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
    }

    // ÊòæÁ§∫ÊéíË°åÊ¶ú
    function showRank() {
      generateRankList();
      document.getElementById('rankBox').style.display = 'block';
    }

    // ÂÖ≥Èó≠ÊéíË°åÊ¶ú
    function closeRank() {
      document.getElementById('rankBox').style.display = 'none';
    }

    // ÊòæÁ§∫Áü•ËØÜÁÇπÂàÜÊûê
    function showAnalysis() {
      const analysisData = analyzeKnowledge();
      let html = '';
      
      // ÊåâÂàÜÁ±ªÊòæÁ§∫Áü•ËØÜÁÇπÊéåÊè°ÊÉÖÂÜµ
      for (const [category, stats] of Object.entries(analysisData.categoryStats)) {
        const percentage = Math.round((stats.correct / stats.total) * 100);
        
        html += `<div class="knowledge-item">
          <div class="knowledge-name">${category} (${stats.correct}/${stats.total})</div>
          <div class="knowledge-progress">
            <div class="knowledge-progress-bar" style="width: ${percentage}%"></div>
          </div>
        </div>`;
      }
      
      document.getElementById('knowledgeAnalysis').innerHTML = html;
      document.getElementById('analysisBox').style.display = 'block';
    }

    // ÂÖ≥Èó≠Áü•ËØÜÁÇπÂàÜÊûê
    function closeAnalysis() {
      document.getElementById('analysisBox').style.display = 'none';
    }

    // Ê£ÄÊü•ÂØÜÁ†Å/ÂßìÂêç
    function checkPassword() {
      const selectedName = document.getElementById('nameSelect').value;
      if (!selectedName) return alert('ËØ∑ÈÄâÊã©ÂßìÂêçÔºÅ');
      
      userName = selectedName;
      document.getElementById('passwordScreen').style.display = 'none';
      document.getElementById('quizScreen').style.display = 'block';
      
      initializeQuiz();
      
      if (currentMode === 'exam') {
        startTimer();
      } else {
        document.getElementById('timer').textContent = 'ÁªÉ‰π†Ê®°Âºè';
      }
    }

    // ÂºÄÂßãËÆ°Êó∂Âô®
    function startTimer() {
      countdownTimer = setInterval(() => {
        remainingTime--;
        updateTimerDisplay();
        
        // Êõ¥Êñ∞ËøõÂ∫¶Êù°
        const progressPercentage = ((CONFIG.totalTime - remainingTime) / CONFIG.totalTime) * 100;
        document.getElementById('progressBar').style.width = `${progressPercentage}%`;
        
        if (remainingTime <= 0) {
          clearInterval(countdownTimer);
          submitQuiz();
        }
      }, 1000);
    }

    // Êõ¥Êñ∞ËÆ°Êó∂Âô®ÊòæÁ§∫
    function updateTimerDisplay() {
      const minutesLeft = Math.floor(remainingTime / 60);
      const secondsLeft = remainingTime % 60;
      document.getElementById('timer').textContent =
        `${String(minutesLeft).padStart(2, '0')}:${String(secondsLeft).padStart(2, '0')}`;
    }

    // ÂàùÂßãÂåñÊµãÈ™å
    function initializeQuiz() {
      showLoader();
      
      // ÂéªÈáçÂ§ÑÁêÜ
      const uniqueQuestions = [];
      const seenQuestions = new Set();
      
      questions.forEach(q => {
        if (!seenQuestions.has(q.question)) {
          seenQuestions.add(q.question);
          uniqueQuestions.push(q);
        }
      });
      
      // Ê†πÊçÆÂàÜÁ±ªÁ≠õÈÄâÈ¢òÁõÆ
      let filteredQuestions = uniqueQuestions;
      if (currentMode === 'practice' && !selectedCategories.includes('all')) {
        filteredQuestions = uniqueQuestions.filter(q => 
          q.categories && q.categories.some(cat => selectedCategories.includes(cat))
      ); 
        }
      
      // ÈöèÊú∫ÈÄâÊã©È¢òÁõÆ
      selectedQuestions = filteredQuestions
        .sort(() => 0.5 - Math.random())
        .slice(0, CONFIG.totalQuestions);
      
      // ÈáçÁΩÆÁä∂ÊÄÅ
      currentQuestionIndex = 0;
      userAnswers = {};
      wrongQuestions = [];
      
      showQuestion(currentQuestionIndex);
      document.getElementById('confirmBtn').style.display = 'block';
      document.getElementById('nextBtn').style.display = 'none';
      
      hideLoader();
    }

    // ÊòæÁ§∫È¢òÁõÆ
    function showQuestion(index) {
      const q = selectedQuestions[index];
      let html = `<div class="question"><p>Á¨¨${index + 1}È¢òÔºö${q.question}</p>`;
      
      // ÊòæÁ§∫ÂàÜÁ±ªÊ†áÁ≠æÔºàÁªÉ‰π†Ê®°ÂºèÔºâ
      if (currentMode === 'practice' && q.categories) {
        html += `<div style="margin-bottom: 10px;">`;
        q.categories.forEach(cat => {
          html += `<span class="category-tag">${cat}</span>`;
        });
        html += `</div>`;
      }
      
      html += `<div class="options">`;
      q.options.forEach(option => html += `
        <label>
          <input type="radio" name="currentQ" value="${option[0]}">
          ${option}
        </label>`);
      html += `</div></div>`;
      
      document.getElementById('currentQuestion').innerHTML = html;
      
      // ÊÅ¢Â§ç‰πãÂâçÁöÑÈÄâÊã©ÔºàÂ¶ÇÊûúÊúâÔºâ
      if (userAnswers[index]) {
        document.querySelector(`input[name="currentQ"][value="${userAnswers[index]}"]`).checked = true;
      }
      
      // Êõ¥Êñ∞ËøõÂ∫¶ÊòæÁ§∫
      if (currentMode === 'exam') {
        document.getElementById('progressBar').style.width = `${(index / selectedQuestions.length) * 100}%`;
      }
    }

    // Ê£ÄÊü•Á≠îÊ°à
    function checkAnswer() {
      const selected = document.querySelector('input[name="currentQ"]:checked');
      if (!selected) return alert('ËØ∑ÈÄâÊã©Á≠îÊ°àÔºÅ');

      const q = selectedQuestions[currentQuestionIndex];
      const feedback = document.getElementById('feedback');
      userAnswers[currentQuestionIndex] = selected.value;

      // Ê£ÄÊü•ÊòØÂê¶Ê≠£Á°Æ
      const isCorrect = selected.value === q.correct;
      
      // Êõ¥Êñ∞ÂèçÈ¶à
      feedback.className = isCorrect ? 'feedback correct-feedback' : 'feedback wrong-feedback';
      feedback.innerHTML = isCorrect ? 
        "‚úÖ ÂõûÁ≠îÊ≠£Á°ÆÔºÅ" : 
        `‚ùå ÂõûÁ≠îÈîôËØØÔºÅÊ≠£Á°ÆÁ≠îÊ°àÔºö<span class="correct-answer">${q.correct}</span>`;
      
      // ËÆ∞ÂΩïÈîôÈ¢ò
      if (!isCorrect) {
        wrongQuestions.push({
          question: q,
          userAnswer: selected.value,
          questionIndex: currentQuestionIndex
        });
      }

      // Êõ¥Êñ∞ÊåâÈíÆ
      document.getElementById('nextBtn').textContent =
        currentQuestionIndex === selectedQuestions.length - 1 ? 'Êèê‰∫§Á≠îÊ°à' : '‰∏ã‰∏ÄÈ¢ò';

      feedback.style.display = 'block';
      document.getElementById('confirmBtn').style.display = 'none';
      document.getElementById('nextBtn').style.display = 'block';
    }

    // ÊòæÁ§∫‰∏ã‰∏ÄÈ¢òÊàñÊèê‰∫§ÊµãÈ™å
    function showNextQuestion() {
      document.getElementById('feedback').style.display = 'none';
      document.getElementById('nextBtn').style.display = 'none';

      if (currentQuestionIndex < selectedQuestions.length - 1) {
        currentQuestionIndex++;
        showQuestion(currentQuestionIndex);
        document.getElementById('confirmBtn').style.display = 'block';
      } else {
        submitQuiz();
      }
    }

    // Êèê‰∫§ÊµãÈ™å
    function submitQuiz() {
      clearInterval(countdownTimer);
      const usedTime = CONFIG.totalTime - remainingTime;

      // ËÆ°ÁÆóÊ≠£Á°ÆÈ¢òÊï∞
      let correct = selectedQuestions.reduce((acc, q, index) =>
        acc + (userAnswers[index] === q.correct ? 1 : 0), 0);

      const totalScore = correct * CONFIG.scorePerQuestion;
      
      // Êõ¥Êñ∞ÊéíË°åÊ¶úÂíåÈîôÈ¢òÊú¨
      if (currentMode === 'exam') {
        updateHighScore(userName, totalScore, usedTime);
      }
      updateWrongQuestions(userName, wrongQuestions);

      // ÊòæÁ§∫ÁªìÊûú
      document.getElementById('quizScreen').style.display = 'none';
      document.getElementById('resultScreen').style.display = 'block';

      const resultName = document.querySelector('#finalResult h2');
      const resultScore = document.querySelector('#finalResult .score');
      const resultCount = document.querySelector('#finalResult h3');

      resultName.textContent = `ËÄÉÁîüÂßìÂêçÔºö${userName}`;
      resultScore.textContent = `ÂæóÂàÜÔºö${totalScore}ÂàÜ${currentMode === 'exam' ? ` (Áî®Êó∂Ôºö${formatTime(usedTime)})` : ''}`;
      resultCount.textContent = `Ê≠£Á°ÆÔºö${correct}È¢ò / ÊÄªËÆ°Ôºö${CONFIG.totalQuestions}È¢ò`;
      
      window.scrollTo(0, 0);
    }

    // ÂàÜÊûêÁü•ËØÜÁÇπÊéåÊè°ÊÉÖÂÜµ
    function analyzeKnowledge() {
      const categoryStats = {};
      const knowledgeStats = {};
      
      selectedQuestions.forEach((q, index) => {
        // ÂàÜÁ±ªÁªüËÆ°
        if (q.categories) {
          q.categories.forEach(cat => {
            categoryStats[cat] = categoryStats[cat] || {correct: 0, total: 0};
            categoryStats[cat].total++;
            if(userAnswers[index] === q.correct) categoryStats[cat].correct++;
          });
        }
        
        // Áü•ËØÜÁÇπÁªüËÆ°
        if (q.knowledge) {
          q.knowledge.forEach(know => {
            knowledgeStats[know] = knowledgeStats[know] || {correct: 0, total: 0};
            knowledgeStats[know].total++;
            if(userAnswers[index] === q.correct) knowledgeStats[know].correct++;
          });
        }
      });
      
      return {
        categoryStats,
        knowledgeStats
      };
    }

    // Â§ç‰π†ÈîôÈ¢ò
    function reviewWrongQuestions() {
      const wrongQuestionsContainer = document.getElementById('wrongQuestionsContainer');
      const wrongQuestionsList = document.getElementById('wrongQuestionsList');
      
      if (wrongQuestionsContainer.style.display === 'none') {
        wrongQuestionsList.innerHTML = '';
        
        if (wrongQuestions.length === 0) {
          wrongQuestionsList.innerHTML = '<p>Ê≤°ÊúâÈîôÈ¢òÈúÄË¶ÅÂ§ç‰π†ÔºÅ</p>';
        } else {
          wrongQuestions.forEach((wrong, index) => {
            const q = wrong.question;
            let html = `<div class="wrong-question">
              <p>Á¨¨${wrong.questionIndex + 1}È¢òÔºö${q.question}</p>
              <div class="options">`;
            
            q.options.forEach(option => {
              const isCorrect = option[0] === q.correct;
              const isWrong = option[0] === wrong.userAnswer;
              let optionClass = '';
              
              if (isCorrect) optionClass = 'correct-answer';
              if (isWrong && !isCorrect) optionClass = 'wrong-answer';
              
              html += `<div class="${optionClass}">${option}</div>`;
            });
            
            html += `</div></div>`;
            wrongQuestionsList.innerHTML += html;
          });
        }
        
        wrongQuestionsContainer.style.display = 'block';
      } else {
        wrongQuestionsContainer.style.display = 'none';
      }
    }

    // È°µÈù¢Âä†ËΩΩÂÆåÊàêÂêéÂàùÂßãÂåñ
    document.addEventListener('DOMContentLoaded', function() {
      initApp();
      setMode('practice'); // ÈªòËÆ§ÁªÉ‰π†Ê®°Âºè
    });
  </script>
</body>
</html>
